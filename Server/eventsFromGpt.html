<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Responsive HTML Template</title>
<script>
async function submitClicked(id, status) {
	const div = document.getElementById("idea" + id);
	const name = div.dataset.name;
	const city = div.dataset.city;
	const state = div.dataset.state;
	const description = div.dataset.description;
	div.innerHTML = "<div>Submitting: " + name + "</div>...";
	try {
		const response =
				await fetch(
						"/submit" +
						"?name=" + encodeURIComponent(name) +
						"&status=" + encodeURIComponent(status) +
						"&city=" + encodeURIComponent(city) +
						"&state=" + encodeURIComponent(state) +
						"&description=" + encodeURIComponent(description) +
						"&origin_query=" + encodeURIComponent("<%= it.query %>"));
		const submissionId = await response.text();
		div.innerHTML = "<div>" + status + ": <a href=\"/submission?submission_id=" + submissionId + "\">" + name + "</a></div>";
	} catch (e) {
		console.log(e);
		div.innerHTML = "<div>Error: " + name + "</div>" + e;
	}
}
</script>
<style>
.idea {
	margin-bottom: 8px;
}
</style>
</head>
<body>
<form method="POST" action="/eventsFromGpt.html">
<div><input style="width: 100%" name="query" type="text" value="<%= it.query %>"/></div>
<div><input type="submit"/></div>
</form>

<form method="POST" action="/eventsFromGpt.html">
<input type="hidden" name="query" type="text" value="<%= it.query %>"/>
<input type="hidden" id="conversation" name="conversation" value=""/>
<div><input type="submit" value="More"/></div>
</form>

<script type="text/javascript">
document.getElementById("conversation").value = JSON.stringify(<%~ it.conversation %>);
</script>

<% it.ideas.forEach(function(idea, i){ %>
	<div
			class="idea"
			id="idea<%= i %>"
			data-name="<%= idea.name %>"
			data-city="<%= idea.city %>"
			data-state="<%= idea.state %>"
			data-description="<%= idea.description %>">
		<div style="display: flex">
			<div style="flex-grow: 1">
				<b><%= idea.normalizedName %></b> in <%= idea.city %>, <%= idea.state %>:
			</div>
			<div style="flex-shrink: 0">
				<button onclick="submitClicked(<%= i %>, 'approved')">Submit</button>
				<button onclick="submitClicked(<%= i %>, 'rejected')">Reject</button>
			</div>
		</div>
		<div><%= idea.description %></div>
		<div><%= idea.notes %></div>
	</div>
<% }) %>
</body>
</html>
